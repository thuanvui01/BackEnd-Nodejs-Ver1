const Recruitment = require('../models/recruitment.model');
const User = require('../models/user.model');
const logService = require('../services/log.services');

exports.create = async (req, res) => {
    //Generated by Quang Thuan at 10/11/20
    try {
        let recruitment = new Recruitment(req.body);
        await recruitment.save()
        res.status(200).send(recruitment);
        await Product.findByIdAndUpdate(recruitment.id,
            {
                $push : {
                    product_history: [{
                        //userID:fields.userID,
                        action : "CREATE",
                        actionName : 'Tạo bài viết tuyển dụng thành công', 
                    }]
                }
            })
    } catch (err) {
        await logService.log_save('5',err)
    }
}

exports.findAll = async (req, res) => {
    let recruitment = await Recruitment.find()
    res.status(200).send(recruitment)
}

//delete('/deleteproduct') tìm và xóa bài viết tuyển dụng
// Create by Quang Thuận

exports.findProductIDandDelete = async(req,res)=>{
    try{
    let product = await Product.deleteMany(req.body)
    if(!product){
        logger.error("delete product not success")
        return res.status(400).send("error delete products")
    }
    let log = new Log({
        "content" : `Delete success product ${product.name}`,
        "level":"1"
    })
    await log.save()
     res.status(200).send("delete complete")  
    // logger.info(`find success banner`)
    } catch (err){
        await logService.log_save('5',err,'Products')
        res.status(404).send(err.message)
    }
}